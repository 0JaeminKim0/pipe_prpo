<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRâ†’PO ìë™í™” AI Agent</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <style>
        .step-active { @apply bg-blue-600 text-white; }
        .step-completed { @apply bg-green-600 text-white; }
        .step-pending { @apply bg-gray-300 text-gray-600; }
        .urgency-urgent { @apply bg-red-50 border-l-4 border-red-500; }
        .urgency-normal { @apply bg-yellow-50 border-l-4 border-yellow-500; }
        .urgency-flexible { @apply bg-green-50 border-l-4 border-green-500; }
        .log-entry { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .sidebar-item:hover { @apply bg-gray-100; }
        .sidebar-item.selected { @apply bg-blue-50 border-l-4 border-blue-600; }
        .tab-active { @apply bg-white border-b-2 border-blue-600 text-blue-600; }
        .tab-inactive { @apply bg-gray-100 text-gray-600 hover:bg-gray-200; }
        .card-stat { @apply bg-white rounded-lg shadow p-6 text-center; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div id="app">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <span class="text-2xl">ğŸ¤–</span>
                    <h1 class="text-xl font-bold text-gray-800">PRâ†’PO ìë™í™” Agent</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-600">ê¸°ì¤€ì¼: 2026-01-01</span>
                    <span id="llmStatus" class="text-sm px-2 py-1 rounded bg-gray-200">LLM í™•ì¸ì¤‘...</span>
                </div>
            </div>
        </header>

        <!-- Progress Steps -->
        <div class="bg-white border-b">
            <div class="max-w-7xl mx-auto px-4 py-6">
                <div class="flex items-center justify-center space-x-4">
                    <div class="step-item flex items-center" data-step="1">
                        <div class="step-circle w-10 h-10 rounded-full flex items-center justify-center step-active">
                            <i class="fas fa-upload"></i>
                        </div>
                        <span class="ml-2 text-sm font-medium">PR ì—…ë¡œë“œ</span>
                    </div>
                    <div class="w-12 h-1 bg-gray-300 step-line" data-line="1"></div>
                    <div class="step-item flex items-center" data-step="2">
                        <div class="step-circle w-10 h-10 rounded-full flex items-center justify-center step-pending">
                            <i class="fas fa-robot"></i>
                        </div>
                        <span class="ml-2 text-sm font-medium">AI ì²˜ë¦¬</span>
                    </div>
                    <div class="w-12 h-1 bg-gray-300 step-line" data-line="2"></div>
                    <div class="step-item flex items-center" data-step="3">
                        <div class="step-circle w-10 h-10 rounded-full flex items-center justify-center step-pending">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <span class="ml-2 text-sm font-medium">ê²¬ì ì˜ë¢°</span>
                    </div>
                    <div class="w-12 h-1 bg-gray-300 step-line" data-line="3"></div>
                    <div class="step-item flex items-center" data-step="4">
                        <div class="step-circle w-10 h-10 rounded-full flex items-center justify-center step-pending">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <span class="ml-2 text-sm font-medium">ìµœì¢…ê²€í† </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 py-6">
            <!-- Step 1: Upload -->
            <div id="step1" class="step-content">
                <div class="bg-white rounded-lg shadow p-8">
                    <h2 class="text-xl font-bold text-center mb-6">ğŸ“¥ PR ë°ì´í„°ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”</h2>
                    
                    <!-- Drop Zone -->
                    <div id="dropZone" class="border-2 border-dashed border-gray-300 rounded-lg p-12 text-center cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition-colors">
                        <input type="file" id="fileInput" multiple accept=".xlsx,.xls,.csv" class="hidden">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-600">íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</p>
                        <p class="text-sm text-gray-400 mt-2">ğŸ“„ .xlsx, .xls ì§€ì›</p>
                    </div>

                    <!-- Uploaded Files -->
                    <div id="uploadedFiles" class="mt-6 hidden">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">ğŸ“ ì—…ë¡œë“œëœ íŒŒì¼</h3>
                        <div id="fileList" class="space-y-2"></div>
                    </div>

                    <!-- Data Summary -->
                    <div id="dataSummary" class="mt-6 hidden">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="grid grid-cols-3 gap-4 text-center">
                                <div>
                                    <p class="text-2xl font-bold text-blue-600" id="prCount">0</p>
                                    <p class="text-sm text-gray-600">PR ê±´ìˆ˜</p>
                                </div>
                                <div>
                                    <p class="text-2xl font-bold text-green-600" id="poCount">0</p>
                                    <p class="text-sm text-gray-600">ë°œì£¼ì‹¤ì </p>
                                </div>
                                <div>
                                    <p class="text-2xl font-bold text-purple-600" id="pzafCount">0</p>
                                    <p class="text-sm text-gray-600">PZAF ìì¬</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Load PR Data Button -->
                    <div class="mt-6 text-center">
                        <button id="loadSampleBtn" class="px-8 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors text-lg shadow-md">
                            ğŸ“‚ PR ë¶ˆëŸ¬ì˜¤ê¸°
                        </button>
                        <p class="text-xs text-gray-500 mt-3">3ê°œ Excel íŒŒì¼ì—ì„œ PR ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤</p>
                        <p class="text-xs text-gray-400">â€¢ DR_1P0K02_25.10~12.êµ¬ë§¤ìš”ì²­ì§„í–‰í˜„í™©.XLSX</p>
                        <p class="text-xs text-gray-400">â€¢ DR_1P0M01_25.10~12.êµ¬ë§¤ìš”ì²­ì§„í–‰í˜„í™©.XLSX</p>
                        <p class="text-xs text-gray-400">â€¢ DR_PZAF ë°œì£¼ì‹¤ì  ìƒì„¸_2025_2026.01.29_11.11.51.xlsx</p>
                    </div>

                    <!-- Start Button -->
                    <div class="mt-8 text-center">
                        <button id="startProcessBtn" class="px-8 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors" disabled>
                            ğŸš€ AI ì²˜ë¦¬ ì‹œì‘
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Processing (Real-time) -->
            <div id="step2" class="step-content hidden">
                <div class="bg-white rounded-lg shadow p-8">
                    <h2 class="text-xl font-bold mb-6">ğŸ¤– AI Agentê°€ PRì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</h2>
                    
                    <!-- Progress Bar -->
                    <div class="mb-6">
                        <div class="flex justify-between text-sm text-gray-600 mb-2">
                            <span id="currentStep">ë°ì´í„° ê²€ì¦ ì¤‘...</span>
                            <span id="progressPercent">0%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div id="progressBar" class="bg-blue-600 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>

                    <!-- Processing Steps Detail -->
                    <div class="border rounded-lg p-4 mb-6">
                        <div id="processingSteps" class="space-y-3">
                            <div class="step-row flex items-center" data-pstep="1">
                                <span class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center mr-3 step-icon">
                                    <span class="step-num">1</span>
                                </span>
                                <span class="flex-1">Step 1. ë°ì´í„° ê²€ì¦</span>
                                <span class="step-result text-sm text-gray-500"></span>
                            </div>
                            <div class="step-row flex items-center" data-pstep="2">
                                <span class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center mr-3 step-icon">
                                    <span class="step-num">2</span>
                                </span>
                                <span class="flex-1">Step 2. ê³„ì•½ ë¶„ë¥˜</span>
                                <span class="step-result text-sm text-gray-500"></span>
                            </div>
                            <div class="step-row flex items-center" data-pstep="3">
                                <span class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center mr-3 step-icon">
                                    <span class="step-num">3</span>
                                </span>
                                <span class="flex-1">Step 3. ê¸´ê¸‰ë„ ë¶„ì„</span>
                                <span class="step-result text-sm text-gray-500"></span>
                            </div>
                            <div class="step-row flex items-center" data-pstep="4">
                                <span class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center mr-3 step-icon">
                                    <span class="step-num">4</span>
                                </span>
                                <span class="flex-1">Step 4. ë‚©í’ˆì—…ì²´ ë§¤ì¹­</span>
                                <span class="step-result text-sm text-gray-500"></span>
                            </div>
                            <div class="step-row flex items-center" data-pstep="5">
                                <span class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center mr-3 step-icon">
                                    <span class="step-num">5</span>
                                </span>
                                <span class="flex-1">Step 5. ì…ì°°ì˜ˆì •ê°€ ì‚°ì • (LLM)</span>
                                <span class="step-result text-sm text-gray-500"></span>
                            </div>
                            <div class="step-row flex items-center" data-pstep="6">
                                <span class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center mr-3 step-icon">
                                    <span class="step-num">6</span>
                                </span>
                                <span class="flex-1">Step 6. ê²¬ì ì˜ë¢°ì„œ ìƒì„±</span>
                                <span class="step-result text-sm text-gray-500"></span>
                            </div>
                            <div class="step-row flex items-center" data-pstep="7">
                                <span class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center mr-3 step-icon">
                                    <span class="step-num">7</span>
                                </span>
                                <span class="flex-1">Step 7. ì ì •ì„± ê²€í†  (LLM)</span>
                                <span class="step-result text-sm text-gray-500"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Log Window -->
                    <div class="bg-gray-900 rounded-lg p-4 h-48 overflow-y-auto">
                        <h3 class="text-green-400 text-sm font-mono mb-2">ğŸ’¬ AI ì‹¤ì‹œê°„ ë¡œê·¸</h3>
                        <div id="logContainer" class="text-sm font-mono space-y-1"></div>
                    </div>
                </div>
            </div>

            <!-- Step 2-1: AI Processing Results (Stepë³„ ìƒì„¸) -->
            <div id="step2-1" class="step-content hidden">
                <div class="bg-white rounded-lg shadow">
                    <!-- Header -->
                    <div class="p-6 border-b">
                        <div class="flex justify-between items-center">
                            <h2 class="text-xl font-bold">âœ… AI ì²˜ë¦¬ ì™„ë£Œ</h2>
                            <span class="text-gray-600">ì´ <span id="resultTotalPR">0</span>ê±´ â†’ <span id="resultProcessedPR">0</span>ê±´ ì²˜ë¦¬</span>
                        </div>
                    </div>

                    <!-- Tab Navigation -->
                    <div class="border-b">
                        <div class="flex">
                            <button class="result-tab tab-active px-6 py-3 font-medium" data-tab="validation">
                                ë°ì´í„°ê²€ì¦ <span class="validation-warning text-red-500 ml-1 hidden">âš ï¸</span>
                            </button>
                            <button class="result-tab tab-inactive px-6 py-3 font-medium" data-tab="contract">
                                ê³„ì•½ë¶„ë¥˜
                            </button>
                            <button class="result-tab tab-inactive px-6 py-3 font-medium" data-tab="urgency">
                                ê¸´ê¸‰ë„
                            </button>
                            <button class="result-tab tab-inactive px-6 py-3 font-medium" data-tab="supplier">
                                ì—…ì²´ë§¤ì¹­ <span class="supplier-warning text-red-500 ml-1 hidden">âš ï¸</span>
                            </button>
                            <button class="result-tab tab-inactive px-6 py-3 font-medium" data-tab="price">
                                ì˜ˆì •ê°€ì‚°ì • <span class="price-warning text-red-500 ml-1 hidden">âš ï¸</span>
                            </button>
                        </div>
                    </div>

                    <!-- Tab Contents -->
                    <div class="p-6">
                        <!-- Tab 1: Data Validation -->
                        <div id="tab-validation" class="tab-content">
                            <h3 class="text-lg font-bold mb-4">ğŸ“‹ ë°ì´í„° ê²€ì¦ ê²°ê³¼</h3>
                            
                            <!-- Summary Cards -->
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div class="card-stat border-l-4 border-green-500">
                                    <p class="text-3xl font-bold text-green-600" id="validCount">0</p>
                                    <p class="text-gray-600">âœ… ìœ íš¨</p>
                                </div>
                                <div class="card-stat border-l-4 border-red-500">
                                    <p class="text-3xl font-bold text-red-600" id="invalidCount">0</p>
                                    <p class="text-gray-600">âš ï¸ ëˆ„ë½</p>
                                </div>
                            </div>

                            <!-- Invalid PR List -->
                            <div id="invalidPRSection" class="hidden">
                                <div class="flex justify-between items-center mb-3">
                                    <h4 class="font-medium">âš ï¸ ëˆ„ë½ PR (ì´ë©”ì¼ ë°œì†¡ í•„ìš”)</h4>
                                    <button onclick="openBatchEmailModal()" class="px-4 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">
                                        <i class="fas fa-envelope mr-1"></i>ì¼ê´„ ë°œì†¡
                                    </button>
                                </div>
                                <div class="border rounded-lg overflow-hidden max-h-80 overflow-y-auto">
                                    <table class="w-full text-sm">
                                        <thead class="bg-gray-50 sticky top-0">
                                            <tr>
                                                <th class="px-4 py-3 text-left">PRë²ˆí˜¸</th>
                                                <th class="px-4 py-3 text-left">ìì¬ë²ˆí˜¸</th>
                                                <th class="px-4 py-3 text-left">ëˆ„ë½í•­ëª©</th>
                                                <th class="px-4 py-3 text-left">ë‹´ë‹¹ì</th>
                                                <th class="px-4 py-3 text-left">ì•¡ì…˜</th>
                                            </tr>
                                        </thead>
                                        <tbody id="invalidPRList"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 2: Contract Classification -->
                        <div id="tab-contract" class="tab-content hidden">
                            <h3 class="text-lg font-bold mb-4">ğŸ“‹ ê³„ì•½ ë¶„ë¥˜ ê²°ê³¼</h3>
                            
                            <!-- Summary Cards -->
                            <div class="grid grid-cols-3 gap-4 mb-6">
                                <div class="card-stat">
                                    <p class="text-3xl font-bold text-blue-600" id="standardCount">0</p>
                                    <p class="text-gray-600">í‘œì¤€ë‹¨ê°€</p>
                                    <p class="text-xs text-gray-400" id="standardPercent">0%</p>
                                </div>
                                <div class="card-stat">
                                    <p class="text-3xl font-bold text-purple-600" id="nonStandardCount">0</p>
                                    <p class="text-gray-600">ë¹„í‘œì¤€ë‹¨ê°€</p>
                                    <p class="text-xs text-gray-400" id="nonStandardPercent">0%</p>
                                </div>
                                <div class="card-stat">
                                    <p class="text-3xl font-bold text-orange-600" id="naCount">0</p>
                                    <p class="text-gray-600">ê²¬ì ëŒ€ìƒ(NA)</p>
                                    <p class="text-xs text-gray-400" id="naPercent">0%</p>
                                </div>
                            </div>

                            <!-- Contract Table -->
                            <div class="border rounded-lg overflow-hidden">
                                <table class="w-full text-sm">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-3 text-left">PRë²ˆí˜¸</th>
                                            <th class="px-4 py-3 text-left">ìì¬ë²ˆí˜¸</th>
                                            <th class="px-4 py-3 text-left">ê³„ì•½ë¶„ë¥˜</th>
                                            <th class="px-4 py-3 text-left">ë‹¨ê°€ê³„ì•½ë²ˆí˜¸</th>
                                        </tr>
                                    </thead>
                                    <tbody id="contractList"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Tab 3: Urgency Analysis -->
                        <div id="tab-urgency" class="tab-content hidden">
                            <h3 class="text-lg font-bold mb-4">ğŸ“‹ ê¸´ê¸‰ë„ ë¶„ì„ ê²°ê³¼ <span class="text-sm font-normal text-gray-500">ê¸°ì¤€ì¼: 2026-01-01</span></h3>
                            
                            <!-- Summary Cards -->
                            <div class="grid grid-cols-3 gap-4 mb-6">
                                <div class="card-stat border-l-4 border-red-500">
                                    <p class="text-3xl font-bold text-red-600" id="urgentCount">0</p>
                                    <p class="text-gray-600">ğŸ”´ ê¸´ê¸‰ (â‰¤2ì¼)</p>
                                    <p class="text-xs text-gray-400" id="urgentPercent">0%</p>
                                </div>
                                <div class="card-stat border-l-4 border-yellow-500">
                                    <p class="text-3xl font-bold text-yellow-600" id="normalCount">0</p>
                                    <p class="text-gray-600">ğŸŸ¡ ì¼ë°˜ (3~5ì¼)</p>
                                    <p class="text-xs text-gray-400" id="normalPercent">0%</p>
                                </div>
                                <div class="card-stat border-l-4 border-green-500">
                                    <p class="text-3xl font-bold text-green-600" id="flexibleCount">0</p>
                                    <p class="text-gray-600">ğŸŸ¢ ì—¬ìœ  (>5ì¼)</p>
                                    <p class="text-xs text-gray-400" id="flexiblePercent">0%</p>
                                </div>
                            </div>

                            <!-- Urgent PR List -->
                            <div class="mb-4">
                                <h4 class="font-medium mb-3">âš ï¸ ê¸´ê¸‰ ì²˜ë¦¬ í•„ìš” PR</h4>
                                <div class="border rounded-lg overflow-hidden max-h-64 overflow-y-auto">
                                    <table class="w-full text-sm">
                                        <thead class="bg-gray-50 sticky top-0">
                                            <tr>
                                                <th class="px-4 py-3 text-left">PRë²ˆí˜¸</th>
                                                <th class="px-4 py-3 text-left">ë‚©ê¸°ì¼</th>
                                                <th class="px-4 py-3 text-left">L/T</th>
                                                <th class="px-4 py-3 text-left">ì”ì—¬ì¼</th>
                                                <th class="px-4 py-3 text-left">ê¸´ê¸‰ë„</th>
                                                <th class="px-4 py-3 text-left">ìì¬ë‚´ì—­</th>
                                            </tr>
                                        </thead>
                                        <tbody id="urgentList"></tbody>
                                    </table>
                                </div>
                            </div>

                            <div id="criticalAlert" class="bg-red-50 border border-red-200 rounded-lg p-4 hidden">
                                <p class="text-red-700">ğŸ’¡ ì”ì—¬ì¼ 0ì¼ ì´í•˜ PR: <span id="criticalCount">0</span>ê±´ â†’ ì¦‰ì‹œ ì²˜ë¦¬ í•„ìš”</p>
                            </div>
                        </div>

                        <!-- Tab 4: Supplier Matching -->
                        <div id="tab-supplier" class="tab-content hidden">
                            <h3 class="text-lg font-bold mb-4">ğŸ“‹ ë‚©í’ˆì—…ì²´ ë§¤ì¹­ ê²°ê³¼</h3>
                            
                            <!-- Summary Cards -->
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div class="card-stat border-l-4 border-green-500">
                                    <p class="text-3xl font-bold text-green-600" id="matchedCount">0</p>
                                    <p class="text-gray-600">âœ… ë§¤ì¹­ ì„±ê³µ</p>
                                    <p class="text-xs text-gray-400" id="matchedPercent">0%</p>
                                </div>
                                <div class="card-stat border-l-4 border-red-500">
                                    <p class="text-3xl font-bold text-red-600" id="unmatchedCount">0</p>
                                    <p class="text-gray-600">âš ï¸ ë§¤ì¹­ ì‹¤íŒ¨</p>
                                    <p class="text-xs text-gray-400" id="unmatchedPercent">0%</p>
                                </div>
                            </div>

                            <!-- Unmatched PR List -->
                            <div id="unmatchedSection" class="mb-6 hidden">
                                <h4 class="font-medium mb-3">âš ï¸ ë§¤ì¹­ ì‹¤íŒ¨ PR (ì‹ ê·œ ì—…ì²´ ì„ ì • í•„ìš”)</h4>
                                <div class="border rounded-lg overflow-hidden">
                                    <table class="w-full text-sm">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th class="px-4 py-3 text-left">PRë²ˆí˜¸</th>
                                                <th class="px-4 py-3 text-left">ìì¬ë²ˆí˜¸</th>
                                                <th class="px-4 py-3 text-left">ìì¬ë‚´ì—­</th>
                                                <th class="px-4 py-3 text-left">ë§¤ì¹­ê²°ê³¼</th>
                                            </tr>
                                        </thead>
                                        <tbody id="unmatchedList"></tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Matched PR List -->
                            <div>
                                <h4 class="font-medium mb-3">âœ… ë§¤ì¹­ ì„±ê³µ PR</h4>
                                <div class="border rounded-lg overflow-hidden max-h-64 overflow-y-auto">
                                    <table class="w-full text-sm">
                                        <thead class="bg-gray-50 sticky top-0">
                                            <tr>
                                                <th class="px-4 py-3 text-left">PRë²ˆí˜¸</th>
                                                <th class="px-4 py-3 text-left">ìì¬ë²ˆí˜¸</th>
                                                <th class="px-4 py-3 text-left">ë§¤ì¹­ì—…ì²´</th>
                                                <th class="px-4 py-3 text-left">ìµœê·¼ë°œì£¼ë‹¨ê°€</th>
                                            </tr>
                                        </thead>
                                        <tbody id="matchedList"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 5: Price Estimation -->
                        <div id="tab-price" class="tab-content hidden">
                            <h3 class="text-lg font-bold mb-4">ğŸ“‹ ì…ì°°ì˜ˆì •ê°€ ì‚°ì • ê²°ê³¼</h3>
                            
                            <!-- Summary Cards -->
                            <div class="grid grid-cols-4 gap-4 mb-6">
                                <div class="card-stat">
                                    <p class="text-2xl font-bold text-blue-600" id="price1Count">0</p>
                                    <p class="text-gray-600 text-sm">ìì¬+ë‚´ì—­ ì¼ì¹˜</p>
                                    <p class="text-xs text-gray-400" id="price1Percent">0%</p>
                                </div>
                                <div class="card-stat">
                                    <p class="text-2xl font-bold text-green-600" id="price2Count">0</p>
                                    <p class="text-gray-600 text-sm">ê·¸ë£¹ í‰ê· ê°€</p>
                                    <p class="text-xs text-gray-400" id="price2Percent">0%</p>
                                </div>
                                <div class="card-stat">
                                    <p class="text-2xl font-bold text-purple-600" id="price3Count">0</p>
                                    <p class="text-gray-600 text-sm">ğŸ§  LLM ì‚°ì •</p>
                                    <p class="text-xs text-gray-400" id="price3Percent">0%</p>
                                </div>
                                <div class="card-stat border-l-4 border-orange-500">
                                    <p class="text-2xl font-bold text-orange-600" id="price4Count">0</p>
                                    <p class="text-gray-600 text-sm">âš ï¸ ê¸°ë³¸ê°’</p>
                                    <p class="text-xs text-gray-400" id="price4Percent">0%</p>
                                </div>
                            </div>

                            <!-- Special Cases -->
                            <div id="priceSpecialSection" class="mb-6 hidden">
                                <h4 class="font-medium mb-3">âš ï¸ íŠ¹ì´ì‚¬í•­ PR (LLM ì‚°ì • / ê¸°ë³¸ê°’ ì ìš©)</h4>
                                <div class="border rounded-lg overflow-hidden">
                                    <table class="w-full text-sm">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th class="px-4 py-3 text-left">PRë²ˆí˜¸</th>
                                                <th class="px-4 py-3 text-left">ìì¬ë‚´ì—­</th>
                                                <th class="px-4 py-3 text-left">ì‚°ì •ë°©ë²•</th>
                                                <th class="px-4 py-3 text-left">ì˜ˆì •ê°€</th>
                                                <th class="px-4 py-3 text-left">ì‹ ë¢°ë„</th>
                                            </tr>
                                        </thead>
                                        <tbody id="priceSpecialList"></tbody>
                                    </table>
                                </div>
                            </div>

                            <div id="priceDefaultAlert" class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 hidden">
                                <p class="text-yellow-700">ğŸ’¡ ê¸°ë³¸ê°’ ì ìš© <span id="defaultPriceCount">0</span>ê±´ â†’ ë‹´ë‹¹ì ì˜ˆì •ê°€ ì§ì ‘ ì…ë ¥ ê¶Œì¥</p>
                            </div>
                        </div>
                    </div>

                    <!-- Footer -->
                    <div class="p-6 border-t bg-gray-50 flex justify-end">
                        <button onclick="goToStep(3)" class="px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700">
                            ë‹¤ìŒ: ê²¬ì ì˜ë¢° ìƒì„± â†’
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 3: Quotation Management -->
            <div id="step3" class="step-content hidden">
                <div class="bg-white rounded-lg shadow">
                    <!-- Header -->
                    <div class="p-4 border-b">
                        <div class="flex justify-between items-center">
                            <h2 class="text-lg font-bold">ğŸ“‹ ê²¬ì ì˜ë¢° ê´€ë¦¬</h2>
                            <span class="text-gray-600">ì²˜ë¦¬í˜„í™©: <span id="quotationTotal">0</span>ê±´ ì¤‘ <span id="quotationAuto">0</span>ê±´ ìë™ì™„ë£Œ</span>
                        </div>
                        <!-- Filters -->
                        <div class="mt-3 flex space-x-3">
                            <select id="urgencyFilter" class="text-sm border rounded px-3 py-2">
                                <option value="all">ê¸´ê¸‰ë„: ì „ì²´</option>
                                <option value="ê¸´ê¸‰">ğŸ”´ ê¸´ê¸‰</option>
                                <option value="ì¼ë°˜">ğŸŸ¡ ì¼ë°˜</option>
                                <option value="ì—¬ìœ ">ğŸŸ¢ ì—¬ìœ </option>
                            </select>
                            <select id="contractFilter" class="text-sm border rounded px-3 py-2">
                                <option value="all">ê³„ì•½ë°©ì‹: ì „ì²´</option>
                                <option value="ìˆ˜ì˜ê³„ì•½">ìˆ˜ì˜ê³„ì•½</option>
                                <option value="ì§€ëª…ê²½ìŸ">ì§€ëª…ê²½ìŸ</option>
                            </select>
                            <select id="statusFilter" class="text-sm border rounded px-3 py-2">
                                <option value="all">ìƒíƒœ: ì „ì²´</option>
                                <option value="ìë™ì™„ë£Œ">âœ… ìë™ì™„ë£Œ</option>
                                <option value="ê²€í† í•„ìš”">âš ï¸ ê²€í† í•„ìš”</option>
                            </select>
                            <input type="text" id="searchInput" placeholder="ğŸ” ê²€ìƒ‰" class="text-sm border rounded px-3 py-2 flex-1">
                        </div>
                    </div>

                    <!-- Main Content: PR List + Detail -->
                    <div class="flex" style="min-height: 600px;">
                        <!-- Left: PR List -->
                        <div class="w-1/3 border-r">
                            <div id="prList" class="overflow-y-auto" style="max-height: 550px;"></div>
                            <div class="p-4 border-t bg-gray-50">
                                <div class="text-sm text-gray-600">
                                    <p>âœ… ìë™ì™„ë£Œ: <span id="autoCompleteCount">0</span>ê±´</p>
                                    <p>âš ï¸ ê²€í† í•„ìš”: <span id="needReviewCount">0</span>ê±´</p>
                                </div>
                            </div>
                        </div>

                        <!-- Right: Detail View (SRM Format) -->
                        <div class="w-2/3 overflow-y-auto" style="max-height: 600px;">
                            <div id="detailView" class="p-6">
                                <div class="text-center text-gray-500 py-20">
                                    <i class="fas fa-file-alt text-4xl mb-4"></i>
                                    <p>PRì„ ì„ íƒí•˜ë©´ ê²¬ì ì˜ë¢° ìƒì„¸ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 4: Final Report -->
            <div id="step4" class="step-content hidden">
                <div class="bg-white rounded-lg shadow p-8">
                    <div class="text-center mb-8">
                        <span class="text-6xl">ğŸ‰</span>
                        <h2 class="text-2xl font-bold mt-4">ì²˜ë¦¬ ì™„ë£Œ</h2>
                        <p class="text-gray-600 mt-2" id="totalProcessed">0ê±´ ì²˜ë¦¬ ì™„ë£Œ</p>
                    </div>

                    <!-- Summary Stats -->
                    <div class="grid grid-cols-2 gap-6 mb-8">
                        <div class="bg-gray-50 rounded-lg p-6">
                            <h3 class="font-bold mb-4">ì²˜ë¦¬ í˜„í™©</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span>ìë™ì²˜ë¦¬</span>
                                    <span class="font-bold text-green-600" id="finalAutoCount">0ê±´</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div id="autoBar" class="bg-green-600 h-2 rounded-full" style="width: 0%"></div>
                                </div>
                                <div class="flex justify-between">
                                    <span>HITL ê²€í† </span>
                                    <span class="font-bold text-orange-600" id="finalHitlCount">0ê±´</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div id="hitlBar" class="bg-orange-500 h-2 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-6">
                            <h3 class="font-bold mb-4">ìƒì„¸ í˜„í™©</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm text-gray-600">ê¸´ê¸‰ë„</p>
                                    <p class="text-red-600">ğŸ”´ ê¸´ê¸‰: <span id="finalUrgent">0</span>ê±´</p>
                                    <p class="text-yellow-600">ğŸŸ¡ ì¼ë°˜: <span id="finalNormal">0</span>ê±´</p>
                                    <p class="text-green-600">ğŸŸ¢ ì—¬ìœ : <span id="finalFlexible">0</span>ê±´</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">AI ì²˜ë¦¬ í†µê³„</p>
                                    <p>LLM í˜¸ì¶œ: <span id="finalLlmCalls">0</span>íšŒ</p>
                                    <p>ì²˜ë¦¬ ì‹œê°„: <span id="finalTime">0</span>ì´ˆ</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex justify-center space-x-4">
                        <button onclick="downloadExcel()" class="px-6 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700">
                            ğŸ“¥ Excel ë‹¤ìš´ë¡œë“œ
                        </button>
                        <button onclick="goToStep(3)" class="px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700">
                            ğŸ“‹ ê²¬ì ì˜ë¢° ê´€ë¦¬
                        </button>
                        <button onclick="batchApprove()" class="px-6 py-3 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700">
                            ğŸš€ SRM ì¼ê´„ ì „ì†¡
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- HITL Review Modal -->
    <div id="hitlModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b">
                <h3 class="text-lg font-bold">âš ï¸ ê²€í† í•„ìš” <span id="modalPrId"></span></h3>
            </div>
            <div class="p-6" id="modalContent">
                <!-- Content will be dynamically populated -->
            </div>
            <div class="p-6 border-t bg-gray-50 flex justify-end space-x-3">
                <button onclick="closeHitlModal()" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">ì·¨ì†Œ</button>
                <button onclick="submitHitlDecision()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">âœ… ê²°ì • ì™„ë£Œ</button>
            </div>
        </div>
    </div>

    <!-- Batch Email Confirmation Modal -->
    <div id="batchEmailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
            <div class="p-6 border-b">
                <h3 class="text-lg font-bold">ğŸ“§ ì´ë©”ì¼ ë°œì†¡ í™•ì¸</h3>
            </div>
            <div class="p-6" id="batchEmailContent">
                <!-- Content will be dynamically populated -->
            </div>
            <div class="p-6 border-t bg-gray-50 flex justify-end space-x-3">
                <button onclick="closeBatchEmailModal()" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">ì·¨ì†Œ</button>
                <button onclick="sendBatchEmails()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                    <i class="fas fa-paper-plane mr-1"></i>ğŸ“§ ë°œì†¡
                </button>
            </div>
        </div>
    </div>

    <!-- Email Preview Modal -->
    <div id="emailPreviewModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b flex justify-between items-center">
                <h3 class="text-lg font-bold">ğŸ“§ ì´ë©”ì¼ ë¯¸ë¦¬ë³´ê¸°</h3>
                <button onclick="closeEmailPreviewModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-6" id="emailPreviewContent">
                <!-- Content will be dynamically populated -->
            </div>
            <div class="p-6 border-t bg-gray-50 flex justify-end">
                <button onclick="closeEmailPreviewModal()" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <!-- Email Sent Success Modal -->
    <div id="emailSentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
            <div class="p-8 text-center">
                <div class="text-6xl mb-4">âœ…</div>
                <h3 class="text-xl font-bold mb-2">ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ</h3>
                <p class="text-gray-600 mb-6" id="emailSentMessage">0ëª…ì—ê²Œ 0ê±´ì˜ ë©”ì¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                <button onclick="closeEmailSentModal()" class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">í™•ì¸</button>
            </div>
        </div>
    </div>

    <script>
        // State
        let currentStep = 1;
        let uploadedFiles = [];
        let quotationData = [];
        let selectedPR = null;
        let processingResults = null;
        let allPRData = [];

        // DOM Elements
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const startProcessBtn = document.getElementById('startProcessBtn');

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkHealth();
            setupDropZone();
            setupFilters();
            setupResultTabs();
        });

        async function checkHealth() {
            try {
                const res = await axios.get('/api/health');
                const llmStatus = document.getElementById('llmStatus');
                if (res.data.hasApiKey) {
                    llmStatus.textContent = 'ğŸ§  LLM í™œì„±í™”';
                    llmStatus.className = 'text-sm px-2 py-1 rounded bg-green-100 text-green-800';
                } else {
                    llmStatus.textContent = 'âš ï¸ LLM ë¯¸ì„¤ì •';
                    llmStatus.className = 'text-sm px-2 py-1 rounded bg-yellow-100 text-yellow-800';
                }
            } catch (e) {
                console.error('Health check failed:', e);
            }
        }

        function setupDropZone() {
            dropZone.addEventListener('click', () => fileInput.click());
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('border-blue-500', 'bg-blue-50');
            });
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('border-blue-500', 'bg-blue-50');
            });
            dropZone.addEventListener('drop', async (e) => {
                e.preventDefault();
                dropZone.classList.remove('border-blue-500', 'bg-blue-50');
                const files = e.dataTransfer.files;
                await handleFiles(files);
            });
            fileInput.addEventListener('change', async (e) => {
                await handleFiles(e.target.files);
            });
        }

        async function handleFiles(files) {
            if (files.length === 0) return;

            const formData = new FormData();
            for (const file of files) {
                formData.append('files', file);
            }

            try {
                const res = await axios.post('/api/upload', formData, {
                    headers: { 'Content-Type': 'multipart/form-data' }
                });

                if (res.data.success) {
                    uploadedFiles = res.data.files;
                    displayUploadedFiles();
                    updateDataSummary();
                    startProcessBtn.disabled = false;
                }
            } catch (e) {
                alert('íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨: ' + (e.response?.data?.error || e.message));
            }
        }

        function displayUploadedFiles() {
            const container = document.getElementById('uploadedFiles');
            const list = document.getElementById('fileList');
            container.classList.remove('hidden');

            list.innerHTML = uploadedFiles.map(f => `
                <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                    <div class="flex items-center">
                        <i class="fas fa-file-excel text-green-600 mr-2"></i>
                        <span class="text-sm">${f.filename}</span>
                        <span class="text-xs text-gray-500 ml-2">(${f.rows.toLocaleString()}ê±´)</span>
                    </div>
                    <span class="text-green-600"><i class="fas fa-check"></i></span>
                </div>
            `).join('');
        }

        async function updateDataSummary() {
            try {
                const res = await axios.get('/api/summary');
                document.getElementById('dataSummary').classList.remove('hidden');
                document.getElementById('prCount').textContent = res.data.prTotal.toLocaleString();
                document.getElementById('poCount').textContent = res.data.poHistoryTotal.toLocaleString();
                document.getElementById('pzafCount').textContent = res.data.pzafCount.toLocaleString();
            } catch (e) {
                console.error('Summary fetch failed:', e);
            }
        }

        // Load Sample Data Button
        document.getElementById('loadSampleBtn').addEventListener('click', loadSampleData);

        async function loadSampleData() {
            const btn = document.getElementById('loadSampleBtn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';

            try {
                const res = await axios.post('/api/load-sample');
                
                if (res.data.success) {
                    uploadedFiles = res.data.files;
                    displayUploadedFiles();
                    await updateDataSummary();
                    startProcessBtn.disabled = false;
                    
                    btn.innerHTML = '<i class="fas fa-check mr-2"></i>ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ';
                    btn.classList.remove('bg-green-600', 'hover:bg-green-700');
                    btn.classList.add('bg-gray-400');
                } else {
                    throw new Error(res.data.error || 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
                }
            } catch (e) {
                alert('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ' + (e.response?.data?.error || e.message));
                btn.disabled = false;
                btn.innerHTML = 'ğŸ“‚ PR ë¶ˆëŸ¬ì˜¤ê¸°';
            }
        }

        // Start Processing
        startProcessBtn.addEventListener('click', startProcessing);

        async function startProcessing() {
            goToStep(2);
            
            // Reset processing UI
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('progressPercent').textContent = '0%';
            document.getElementById('logContainer').innerHTML = '';
            
            // Reset step icons
            document.querySelectorAll('#processingSteps .step-row').forEach(row => {
                row.querySelector('.step-icon').classList.remove('bg-green-500', 'bg-blue-500');
                row.querySelector('.step-icon').classList.add('bg-gray-200');
                row.querySelector('.step-result').textContent = '';
            });

            try {
                addLogEntry('AI Agent ì‹œì‘...', 'info');

                const res = await axios.post('/api/process');
                
                if (res.data.success) {
                    processingResults = res.data.results;
                    quotationData = res.data.results.quotationData || [];
                    allPRData = res.data.results.allPRData || quotationData;
                    
                    // Update progress to 100%
                    document.getElementById('progressBar').style.width = '100%';
                    document.getElementById('progressPercent').textContent = '100%';
                    document.getElementById('currentStep').textContent = 'ì²˜ë¦¬ ì™„ë£Œ!';

                    // Mark all steps as complete
                    document.querySelectorAll('#processingSteps .step-row').forEach(row => {
                        row.querySelector('.step-icon').classList.remove('bg-gray-200');
                        row.querySelector('.step-icon').classList.add('bg-green-500');
                        row.querySelector('.step-icon').innerHTML = '<i class="fas fa-check text-white"></i>';
                    });

                    // Show completion logs
                    if (res.data.results.summary) {
                        displaySummaryLogs(res.data.results.summary);
                    }

                    // Transition to Step 2-1 (Results) after 2 seconds
                    setTimeout(() => {
                        showResultsStep();
                    }, 2000);
                }
            } catch (e) {
                addLogEntry('ì˜¤ë¥˜ ë°œìƒ: ' + (e.response?.data?.error || e.message), 'error');
            }
        }

        function displaySummaryLogs(summary) {
            addLogEntry(`âœ… ì´ ì²˜ë¦¬ ê±´ìˆ˜: ${summary.total}ê±´`, 'success');
            addLogEntry(`ğŸ”´ ê¸´ê¸‰: ${summary.urgent}ê±´, ğŸŸ¡ ì¼ë°˜: ${summary.normal}ê±´, ğŸŸ¢ ì—¬ìœ : ${summary.flexible}ê±´`, 'info');
            addLogEntry(`ìë™ì™„ë£Œ: ${summary.autoComplete}ê±´, ê²€í† í•„ìš”: ${summary.needReview}ê±´`, 'info');
            addLogEntry(`LLM í˜¸ì¶œ: ${summary.llmCalls}íšŒ`, 'info');
            addLogEntry(`ì²˜ë¦¬ ì‹œê°„: ${summary.processingTime}ì´ˆ`, 'success');
        }

        function addLogEntry(message, type = 'info') {
            const container = document.getElementById('logContainer');
            const colors = {
                info: 'text-gray-300',
                success: 'text-green-400',
                warning: 'text-yellow-400',
                error: 'text-red-400'
            };
            const time = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `log-entry ${colors[type] || colors.info}`;
            entry.innerHTML = `<span class="text-gray-500">${time}</span> ${message}`;
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
        }

        // Show Step 2-1 Results
        function showResultsStep() {
            // Hide step2 and show step2-1
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step2-1').classList.remove('hidden');
            
            // Populate results
            populateResultsTabs();
        }

        // Result Tabs
        function setupResultTabs() {
            document.querySelectorAll('.result-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.dataset.tab;
                    
                    // Update tab styles
                    document.querySelectorAll('.result-tab').forEach(t => {
                        t.classList.remove('tab-active');
                        t.classList.add('tab-inactive');
                    });
                    tab.classList.remove('tab-inactive');
                    tab.classList.add('tab-active');
                    
                    // Show corresponding content
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
                    document.getElementById(`tab-${tabId}`).classList.remove('hidden');
                });
            });
        }

        function populateResultsTabs() {
            if (!processingResults) return;
            
            const summary = processingResults.summary;
            const invalidPR = processingResults.invalidPR || [];
            
            // Header totals
            document.getElementById('resultTotalPR').textContent = (summary.total + invalidPR.length).toLocaleString();
            document.getElementById('resultProcessedPR').textContent = summary.total.toLocaleString();
            
            // Tab 1: Validation
            const validCount = summary.total;
            const invalidCount = invalidPR.length;
            document.getElementById('validCount').textContent = validCount.toLocaleString();
            document.getElementById('invalidCount').textContent = invalidCount.toLocaleString();
            
            if (invalidCount > 0) {
                document.querySelector('.validation-warning').classList.remove('hidden');
                document.getElementById('invalidPRSection').classList.remove('hidden');
                document.getElementById('invalidPRList').innerHTML = invalidPR.slice(0, 50).map((pr, idx) => `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="px-4 py-3">âš ï¸ ${pr['êµ¬ë§¤ìš”ì²­'] || '-'}</td>
                        <td class="px-4 py-3">${pr['ìì¬ë²ˆí˜¸'] || '-'}</td>
                        <td class="px-4 py-3 text-red-600">${pr['ëˆ„ë½í•­ëª©'] || '-'}</td>
                        <td class="px-4 py-3">${pr['ë‹´ë‹¹ì'] || pr['êµ¬ë§¤ìš”ì²­ì'] || '-'}</td>
                        <td class="px-4 py-3">
                            <button onclick="openEmailPreview(${idx})" class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200">
                                ğŸ“§ ë¯¸ë¦¬ë³´ê¸°
                            </button>
                        </td>
                    </tr>
                `).join('');
            }
            
            // Tab 2: Contract Classification
            const cs = summary.contractSummary || {};
            const total = (cs.standard || 0) + (cs.nonStandard || 0) + (cs.na || 0);
            document.getElementById('standardCount').textContent = (cs.standard || 0).toLocaleString();
            document.getElementById('nonStandardCount').textContent = (cs.nonStandard || 0).toLocaleString();
            document.getElementById('naCount').textContent = (cs.na || 0).toLocaleString();
            document.getElementById('standardPercent').textContent = total > 0 ? `${((cs.standard || 0) / total * 100).toFixed(1)}%` : '0%';
            document.getElementById('nonStandardPercent').textContent = total > 0 ? `${((cs.nonStandard || 0) / total * 100).toFixed(1)}%` : '0%';
            document.getElementById('naPercent').textContent = total > 0 ? `${((cs.na || 0) / total * 100).toFixed(1)}%` : '0%';
            
            document.getElementById('contractList').innerHTML = quotationData.slice(0, 20).map(pr => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="px-4 py-3">${pr['êµ¬ë§¤ìš”ì²­'] || '-'}</td>
                    <td class="px-4 py-3">${pr['ìì¬ë²ˆí˜¸'] || '-'}</td>
                    <td class="px-4 py-3">
                        <span class="px-2 py-1 rounded text-xs ${pr['ê³„ì•½ë¶„ë¥˜'] === 'í‘œì¤€ë‹¨ê°€' ? 'bg-blue-100 text-blue-800' : pr['ê³„ì•½ë¶„ë¥˜'] === 'NA' ? 'bg-orange-100 text-orange-800' : 'bg-gray-100'}">
                            ${pr['ê³„ì•½ë¶„ë¥˜'] || '-'}
                        </span>
                    </td>
                    <td class="px-4 py-3">${pr['ë‹¨ê°€ê³„ì•½ë²ˆí˜¸'] || '-'}</td>
                </tr>
            `).join('');
            
            // Tab 3: Urgency
            document.getElementById('urgentCount').textContent = (summary.urgent || 0).toLocaleString();
            document.getElementById('normalCount').textContent = (summary.normal || 0).toLocaleString();
            document.getElementById('flexibleCount').textContent = (summary.flexible || 0).toLocaleString();
            document.getElementById('urgentPercent').textContent = summary.total > 0 ? `${((summary.urgent || 0) / summary.total * 100).toFixed(1)}%` : '0%';
            document.getElementById('normalPercent').textContent = summary.total > 0 ? `${((summary.normal || 0) / summary.total * 100).toFixed(1)}%` : '0%';
            document.getElementById('flexiblePercent').textContent = summary.total > 0 ? `${((summary.flexible || 0) / summary.total * 100).toFixed(1)}%` : '0%';
            
            const urgentPRs = quotationData.filter(pr => pr['ê¸´ê¸‰ë„'] === 'ê¸´ê¸‰').slice(0, 20);
            document.getElementById('urgentList').innerHTML = urgentPRs.map(pr => `
                <tr class="border-b hover:bg-gray-50 bg-red-50">
                    <td class="px-4 py-3">ğŸ”´ ${pr['êµ¬ë§¤ìš”ì²­'] || '-'}</td>
                    <td class="px-4 py-3">${pr['PRë‚©ê¸°ì¼'] || '-'}</td>
                    <td class="px-4 py-3">${pr['LEAD_TIME'] || '-'}ì¼</td>
                    <td class="px-4 py-3">${pr['ì‹¤ì œì”ì—¬ì¼ìˆ˜'] || '-'}ì¼</td>
                    <td class="px-4 py-3"><span class="text-red-600 font-medium">ê¸´ê¸‰</span></td>
                    <td class="px-4 py-3 truncate max-w-xs">${(pr['ë‚´ì—­'] || '').substring(0, 30)}...</td>
                </tr>
            `).join('');
            
            const criticalPRs = quotationData.filter(pr => (pr['ì‹¤ì œì”ì—¬ì¼ìˆ˜'] || 999) <= 0);
            if (criticalPRs.length > 0) {
                document.getElementById('criticalAlert').classList.remove('hidden');
                document.getElementById('criticalCount').textContent = criticalPRs.length;
            }
            
            // Tab 4: Supplier Matching
            const matched = quotationData.filter(pr => pr['ì—…ì²´ë§¤ì¹­ì—¬ë¶€']).length;
            const unmatched = quotationData.filter(pr => !pr['ì—…ì²´ë§¤ì¹­ì—¬ë¶€']).length;
            document.getElementById('matchedCount').textContent = matched.toLocaleString();
            document.getElementById('unmatchedCount').textContent = unmatched.toLocaleString();
            document.getElementById('matchedPercent').textContent = summary.total > 0 ? `${(matched / summary.total * 100).toFixed(1)}%` : '0%';
            document.getElementById('unmatchedPercent').textContent = summary.total > 0 ? `${(unmatched / summary.total * 100).toFixed(1)}%` : '0%';
            
            if (unmatched > 0) {
                document.querySelector('.supplier-warning').classList.remove('hidden');
                document.getElementById('unmatchedSection').classList.remove('hidden');
                document.getElementById('unmatchedList').innerHTML = quotationData.filter(pr => !pr['ì—…ì²´ë§¤ì¹­ì—¬ë¶€']).slice(0, 10).map(pr => `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="px-4 py-3">âš ï¸ ${pr['êµ¬ë§¤ìš”ì²­'] || '-'}</td>
                        <td class="px-4 py-3">${pr['ìì¬ë²ˆí˜¸'] || '-'}</td>
                        <td class="px-4 py-3 truncate max-w-xs">${(pr['ë‚´ì—­'] || '').substring(0, 30)}...</td>
                        <td class="px-4 py-3 text-red-600">ê³¼ê±°ì‹¤ì ì—†ìŒ</td>
                    </tr>
                `).join('');
            }
            
            document.getElementById('matchedList').innerHTML = quotationData.filter(pr => pr['ì—…ì²´ë§¤ì¹­ì—¬ë¶€']).slice(0, 20).map(pr => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="px-4 py-3">${pr['êµ¬ë§¤ìš”ì²­'] || '-'}</td>
                    <td class="px-4 py-3">${pr['ìì¬ë²ˆí˜¸'] || '-'}</td>
                    <td class="px-4 py-3">${pr['ë§¤ì¹­ì—…ì²´ëª…'] || '-'}</td>
                    <td class="px-4 py-3">â‚©${(pr['ìµœê·¼ë°œì£¼ë‹¨ê°€'] || 0).toLocaleString()}</td>
                </tr>
            `).join('');
            
            // Tab 5: Price Estimation
            const priceMethods = summary.priceMethodSummary || {};
            const price1 = priceMethods['ìì¬+ë‚´ì—­ ì¼ì¹˜'] || 0;
            const price2 = priceMethods['ê·¸ë£¹ í‰ê· '] || 0;
            const price3 = priceMethods['LLM ì‚°ì •'] || 0;
            const price4 = priceMethods['ê¸°ë³¸ê°’'] || 0;
            const priceTotal = price1 + price2 + price3 + price4;
            
            document.getElementById('price1Count').textContent = price1.toLocaleString();
            document.getElementById('price2Count').textContent = price2.toLocaleString();
            document.getElementById('price3Count').textContent = price3.toLocaleString();
            document.getElementById('price4Count').textContent = price4.toLocaleString();
            document.getElementById('price1Percent').textContent = priceTotal > 0 ? `${(price1 / priceTotal * 100).toFixed(1)}%` : '0%';
            document.getElementById('price2Percent').textContent = priceTotal > 0 ? `${(price2 / priceTotal * 100).toFixed(1)}%` : '0%';
            document.getElementById('price3Percent').textContent = priceTotal > 0 ? `${(price3 / priceTotal * 100).toFixed(1)}%` : '0%';
            document.getElementById('price4Percent').textContent = priceTotal > 0 ? `${(price4 / priceTotal * 100).toFixed(1)}%` : '0%';
            
            const specialPRs = quotationData.filter(pr => pr['ì˜ˆì •ê°€_ì‚°ì •ë°©ë²•'] === 'LLM ì‚°ì •' || pr['ì˜ˆì •ê°€_ì‚°ì •ë°©ë²•'] === 'ê¸°ë³¸ê°’');
            if (specialPRs.length > 0) {
                document.querySelector('.price-warning').classList.remove('hidden');
                document.getElementById('priceSpecialSection').classList.remove('hidden');
                document.getElementById('priceSpecialList').innerHTML = specialPRs.slice(0, 10).map(pr => `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="px-4 py-3">${pr['ì˜ˆì •ê°€_ì‚°ì •ë°©ë²•'] === 'LLM ì‚°ì •' ? 'ğŸ§ ' : 'âš ï¸'} ${pr['êµ¬ë§¤ìš”ì²­'] || '-'}</td>
                        <td class="px-4 py-3 truncate max-w-xs">${(pr['ë‚´ì—­'] || '').substring(0, 30)}...</td>
                        <td class="px-4 py-3">${pr['ì˜ˆì •ê°€_ì‚°ì •ë°©ë²•'] || '-'}</td>
                        <td class="px-4 py-3">â‚©${(pr['ì…ì°°ì˜ˆì •ê°€'] || 0).toLocaleString()}</td>
                        <td class="px-4 py-3">${pr['LLMì‘ë‹µ']?.['ì‹ ë¢°ë„'] || '-'}</td>
                    </tr>
                `).join('');
            }
            
            if (price4 > 0) {
                document.getElementById('priceDefaultAlert').classList.remove('hidden');
                document.getElementById('defaultPriceCount').textContent = price4;
            }
        }

        // Step Navigation
        function goToStep(step) {
            currentStep = step;
            
            // Hide all step content
            document.querySelectorAll('.step-content').forEach(el => el.classList.add('hidden'));
            
            // Handle special case for step 2-1
            if (step === '2-1') {
                document.getElementById('step2-1').classList.remove('hidden');
                step = 2;
            } else {
                document.getElementById(`step${step}`).classList.remove('hidden');
            }

            // Update step indicators
            document.querySelectorAll('.step-item[data-step]').forEach((el) => {
                const stepNum = parseInt(el.getAttribute('data-step'));
                const circle = el.querySelector('.step-circle');
                if (circle) {
                    if (stepNum < step) {
                        circle.className = 'step-circle w-10 h-10 rounded-full flex items-center justify-center step-completed';
                    } else if (stepNum === step) {
                        circle.className = 'step-circle w-10 h-10 rounded-full flex items-center justify-center step-active';
                    } else {
                        circle.className = 'step-circle w-10 h-10 rounded-full flex items-center justify-center step-pending';
                    }
                }
            });

            // Update step lines
            document.querySelectorAll('.step-line').forEach((el) => {
                const lineNum = parseInt(el.getAttribute('data-line'));
                if (lineNum < step) {
                    el.classList.remove('bg-gray-300');
                    el.classList.add('bg-green-600');
                } else {
                    el.classList.remove('bg-green-600');
                    el.classList.add('bg-gray-300');
                }
            });

            // Load data for specific steps
            if (step === 3) {
                renderPRList();
                updateQuotationCounts();
            }
            if (step === 4) {
                updateFinalReport();
            }
        }

        // PR List & Detail (Step 3)
        function setupFilters() {
            document.getElementById('urgencyFilter').addEventListener('change', renderPRList);
            document.getElementById('contractFilter')?.addEventListener('change', renderPRList);
            document.getElementById('statusFilter').addEventListener('change', renderPRList);
            document.getElementById('searchInput')?.addEventListener('input', renderPRList);
        }

        function updateQuotationCounts() {
            document.getElementById('quotationTotal').textContent = quotationData.length;
            document.getElementById('quotationAuto').textContent = quotationData.filter(p => p['ì²˜ë¦¬ìƒíƒœ'] === 'ìë™ì™„ë£Œ').length;
        }

        function renderPRList() {
            const urgencyFilter = document.getElementById('urgencyFilter').value;
            const contractFilter = document.getElementById('contractFilter')?.value || 'all';
            const statusFilter = document.getElementById('statusFilter').value;
            const searchText = document.getElementById('searchInput')?.value?.toLowerCase() || '';

            let filtered = [...quotationData];

            if (urgencyFilter !== 'all') {
                filtered = filtered.filter(pr => pr['ê¸´ê¸‰ë„'] === urgencyFilter);
            }
            if (contractFilter !== 'all') {
                filtered = filtered.filter(pr => pr['ê³„ì•½ë°©ì‹'] === contractFilter);
            }
            if (statusFilter !== 'all') {
                filtered = filtered.filter(pr => pr['ì²˜ë¦¬ìƒíƒœ'] === statusFilter);
            }
            if (searchText) {
                filtered = filtered.filter(pr => 
                    (pr['êµ¬ë§¤ìš”ì²­'] || '').toLowerCase().includes(searchText) ||
                    (pr['ìì¬ë²ˆí˜¸'] || '').toLowerCase().includes(searchText) ||
                    (pr['ë‚´ì—­'] || '').toLowerCase().includes(searchText)
                );
            }

            const container = document.getElementById('prList');
            container.innerHTML = filtered.map(pr => {
                const urgencyClass = pr['ê¸´ê¸‰ë„'] === 'ê¸´ê¸‰' ? 'urgency-urgent' : 
                                    pr['ê¸´ê¸‰ë„'] === 'ì¼ë°˜' ? 'urgency-normal' : 'urgency-flexible';
                const statusIcon = pr['ì²˜ë¦¬ìƒíƒœ'] === 'ìë™ì™„ë£Œ' ? 'âœ…' : 'âš ï¸';
                
                return `
                    <div class="sidebar-item p-3 border-b cursor-pointer ${urgencyClass} ${selectedPR === pr['êµ¬ë§¤ìš”ì²­'] ? 'selected' : ''}"
                         onclick="selectPR('${pr['êµ¬ë§¤ìš”ì²­']}')">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-medium">${pr['ê¸´ê¸‰ë„_ì‹ í˜¸'] || 'ğŸŸ¡'} ${pr['êµ¬ë§¤ìš”ì²­']}</p>
                                <p class="text-xs text-gray-600 truncate" style="max-width: 200px;">${pr['ë‚´ì—­'] || ''}</p>
                            </div>
                            <span class="text-sm">${statusIcon}</span>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">
                            ${pr['ê³„ì•½ë°©ì‹'] || ''} | ${pr['ê¸´ê¸‰ë„'] || ''}
                        </div>
                    </div>
                `;
            }).join('');

            // Update counts
            const autoComplete = quotationData.filter(p => p['ì²˜ë¦¬ìƒíƒœ'] === 'ìë™ì™„ë£Œ').length;
            const needReview = quotationData.filter(p => p['ì²˜ë¦¬ìƒíƒœ'] === 'ê²€í† í•„ìš”').length;
            document.getElementById('autoCompleteCount').textContent = autoComplete;
            document.getElementById('needReviewCount').textContent = needReview;
        }

        function selectPR(prId) {
            selectedPR = prId;
            renderPRList();
            renderDetailView(prId);
        }

        function renderDetailView(prId) {
            const pr = quotationData.find(p => p['êµ¬ë§¤ìš”ì²­'] === prId);
            if (!pr) return;

            const container = document.getElementById('detailView');
            const estimatedPrice = pr['ì…ì°°ì˜ˆì •ê°€'] || 0;
            const quotedPrice = pr['Mock_ê²¬ì ê¸ˆì•¡'] || 0;
            const exchangeRate = 1453;
            const estimatedPriceUSD = Math.round(estimatedPrice / exchangeRate);
            
            // ì´ˆì²­í˜‘ë ¥íšŒì‚¬ 2~3ê°œ ëœë¤ ìƒì„± (ë§¤ì¹­ì—…ì²´ í¬í•¨)
            const randomVendors = pr['ì´ˆì²­í˜‘ë ¥íšŒì‚¬'] || generateRandomVendors(pr);

            container.innerHTML = `
                <div class="space-y-4">
                    <!-- Header -->
                    <div class="flex justify-between items-start pb-4 border-b">
                        <div>
                            <div class="flex items-center space-x-2 mb-1">
                                <span class="bg-gray-200 text-gray-700 px-2 py-1 rounded text-xs">ê²¬ì ì˜ë¢°ë²ˆí˜¸</span>
                                <span class="font-bold">RFQ-${pr['êµ¬ë§¤ìš”ì²­']}</span>
                            </div>
                            <p class="text-gray-600 text-sm">ì°¨ìˆ˜: 1</p>
                        </div>
                        <span class="px-3 py-1 rounded-full text-sm font-medium ${
                            pr['ì²˜ë¦¬ìƒíƒœ'] === 'ìë™ì™„ë£Œ' ? 'bg-green-100 text-green-800' : 'bg-orange-100 text-orange-800'
                        }">
                            ${pr['ì²˜ë¦¬ìƒíƒœ'] === 'ìë™ì™„ë£Œ' ? 'âœ… ìë™ì™„ë£Œ' : 'âš ï¸ ê²€í† í•„ìš”'}
                        </span>
                    </div>

                    <!-- ê¸°ë³¸ì •ë³´ -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-medium text-sm text-gray-700 mb-3">ê¸°ë³¸ì •ë³´</h4>
                        <div class="grid grid-cols-2 gap-3 text-sm">
                            <div><span class="text-gray-500">ì…ì°°ëª©ì ë¬¼</span><p class="font-medium">${pr['ë‚´ì—­'] || '-'}</p></div>
                            <div><span class="text-gray-500">ì†Œì‹±ê·¸ë£¹</span><p class="font-medium">${pr['ì†Œì‹±ê·¸ë£¹'] || '-'}</p></div>
                            <div><span class="text-gray-500">êµ¬ë§¤ë‹´ë‹¹</span><p class="font-medium">${pr['êµ¬ë§¤ì›'] || '-'}</p></div>
                            <div><span class="text-gray-500">ì‹œë¦¬ì¦ˆí˜¸ì„ </span><p class="font-medium">${(pr['ìì¬ë²ˆí˜¸'] || '').substring(0, 4) || '-'}</p></div>
                            <div><span class="text-gray-500">ì¼ë°˜/ê¸´ê¸‰</span><p class="font-medium">${pr['ê¸´ê¸‰ë„_ì‹ í˜¸'] || ''} ${pr['ê¸´ê¸‰ë„'] || '-'}</p></div>
                        </div>
                    </div>

                    <!-- ê³„ì•½ì •ë³´ -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-medium text-sm text-gray-700 mb-3">ê³„ì•½ì •ë³´</h4>
                        <div class="grid grid-cols-2 gap-3 text-sm">
                            <div><span class="text-gray-500">ê³„ì•½ë°©ì‹</span><p class="font-medium">${pr['ê³„ì•½ë°©ì‹'] || '-'}</p></div>
                            <div><span class="text-gray-500">ê³„ì•½ëŒ€ìƒìì„ ì •ë°©ì‹</span><p class="font-medium">ìµœì €ê°€</p></div>
                            <div><span class="text-gray-500">ë‹¨ê°€ê³„ì•½ì—¬ë¶€</span><p class="font-medium">${pr['ê³„ì•½ë¶„ë¥˜'] || '-'}</p></div>
                            <div><span class="text-gray-500">ë‹¨ê°€ê³„ì•½ë²ˆí˜¸</span><p class="font-medium">${pr['ë‹¨ê°€ê³„ì•½ë²ˆí˜¸'] || '-'}</p></div>
                        </div>
                    </div>

                    <!-- ì…ì°°ì¡°ê±´ (ì‹ ê·œ) -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-medium text-sm text-gray-700 mb-3">ì…ì°°ì¡°ê±´</h4>
                        <div class="grid grid-cols-3 gap-3 text-sm">
                            <div class="flex items-center justify-between">
                                <span class="text-gray-500">ì¡°ê±´ ë³€ê²½ ê°€ëŠ¥</span>
                                <select class="text-xs border rounded px-2 py-1 bg-white">
                                    <option value="Y" selected>Y</option>
                                    <option value="N">N</option>
                                </select>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-500">ì—…ì²´ ì„ ì • ë°©ì‹</span>
                                <span class="font-medium">ë¬¸ì„œë³„</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-500">ë¶€ë¶„ ì…ì°° ê°€ëŠ¥</span>
                                <select class="text-xs border rounded px-2 py-1 bg-white">
                                    <option value="Y" selected>Y</option>
                                    <option value="N">N</option>
                                </select>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-500">ì „ìê³„ì•½ ì—¬ë¶€</span>
                                <select class="text-xs border rounded px-2 py-1 bg-white">
                                    <option value="Y" selected>Y</option>
                                    <option value="N">N</option>
                                </select>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-500">AVL í’ˆëª© ì—¬ë¶€</span>
                                <select class="text-xs border rounded px-2 py-1 bg-white">
                                    <option value="Y" selected>Y</option>
                                    <option value="N">N</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- ì ‘ìˆ˜/í‰ê°€ -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-medium text-sm text-gray-700 mb-3">ì ‘ìˆ˜/í‰ê°€</h4>
                        <div class="grid grid-cols-2 gap-3 text-sm">
                            <div><span class="text-gray-500">ì ‘ìˆ˜ê¸°ê°„</span><p class="font-medium">${pr['ì ‘ìˆ˜ê¸°ê°„_ì¼'] || 3}ì¼ ${pr['ê¸´ê¸‰ë„'] === 'ê¸´ê¸‰' ? '(ê¸´ê¸‰)' : ''}</p></div>
                            <div><span class="text-gray-500">ê¸°ìˆ í‰ê°€ëŒ€ìƒ</span><p class="font-medium">${pr['ê¸°ìˆ í‰ê°€ëŒ€ìƒ'] || 'N'}</p></div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-500">ê¸°ìˆ ìë£Œìš”êµ¬ì„œ</span>
                                <select class="text-xs border rounded px-2 py-1 bg-white">
                                    <option value="Y" selected>Y</option>
                                    <option value="N">N</option>
                                </select>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-500">ë¹„ë°€ìœ ì§€ì„œì•½ ì—¬ë¶€</span>
                                <select class="text-xs border rounded px-2 py-1 bg-white">
                                    <option value="Y" selected>Y</option>
                                    <option value="N">N</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- ê¸ˆì•¡ì •ë³´ -->
                    <div class="bg-blue-50 rounded-lg p-4">
                        <h4 class="font-medium text-sm text-gray-700 mb-3">ê¸ˆì•¡ì •ë³´</h4>
                        <div class="grid grid-cols-3 gap-4 text-center mb-4">
                            <div>
                                <p class="text-xs text-gray-500">ì…ì°°ì˜ˆì •ê°€(KRW)</p>
                                <p class="text-lg font-bold text-blue-600">â‚©${estimatedPrice.toLocaleString()}</p>
                                <p class="text-xs text-gray-500">${pr['ì˜ˆì •ê°€_ì‚°ì •ë°©ë²•'] || ''}</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500">ì˜ˆì‚°ê¸ˆì•¡(KRW)</p>
                                <p class="text-lg font-bold">â‚©${estimatedPrice.toLocaleString()}</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500">ì˜ˆì‚°ê¸ˆì•¡(USD)</p>
                                <p class="text-lg font-bold text-green-600">$${estimatedPriceUSD.toLocaleString()}</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-3 gap-4 text-center border-t pt-3">
                            <div>
                                <p class="text-xs text-gray-500">ì˜ˆì‚°ê¸ˆì•¡í™˜ìœ¨</p>
                                <p class="font-medium">${exchangeRate.toLocaleString()}ì›</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500">ìš”ì²­ìˆ˜ëŸ‰</p>
                                <p class="font-medium">${pr['ìš”ì²­ìˆ˜ëŸ‰'] || '-'} ${pr['UOM'] || 'EA'}</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500">ì´ì¤‘ëŸ‰(KG)</p>
                                <p class="font-medium">${pr['ë§¤ì¹­_ë°œì£¼ì¤‘ëŸ‰'] || pr['ì´ì¤‘ëŸ‰'] || '-'}</p>
                            </div>
                        </div>
                    </div>

                    <!-- í˜‘ë ¥íšŒì‚¬ -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-medium text-sm text-gray-700 mb-3">ì´ˆì²­í˜‘ë ¥íšŒì‚¬ <span class="text-xs text-gray-400">(2~3ê°œ ëœë¤ ì„ ì •)</span></h4>
                        <div class="space-y-2">
                            ${randomVendors.map((vendor, idx) => `
                                <label class="flex items-center">
                                    <input type="checkbox" checked class="mr-2">
                                    <span>${vendor.name} ${vendor.isMatched ? '<span class="text-xs text-blue-600">(ë§¤ì¹­ì—…ì²´)</span>' : ''}</span>
                                </label>
                            `).join('')}
                            ${pr['ê³„ì•½ë°©ì‹'] === 'ì§€ëª…ê²½ìŸ' ? `
                                <button class="text-sm text-blue-600 hover:underline mt-2">+ ì—…ì²´ ì¶”ê°€</button>
                            ` : ''}
                        </div>
                        <div class="mt-3 p-2 bg-gray-200 rounded text-xs text-gray-500">
                            <i class="fas fa-info-circle mr-1"></i>ì´ì „ê²¬ì ì˜ë¢° ìµœê³ í‰ê°€í˜‘ë ¥ì‚¬ ëˆ„ë½ ì—¬ë¶€
                        </div>
                    </div>

                    <!-- ì„ ì •ì‚¬ìœ  -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-medium text-sm text-gray-700 mb-3">ì„ ì •ì‚¬ìœ </h4>
                        <div class="space-y-3 text-sm">
                            <div>
                                <p class="text-gray-500">ê³„ì•½ë°©ì‹ ì„ ì •ì‚¬ìœ </p>
                                <p class="text-xs bg-white p-2 rounded border">${pr['ê³„ì•½ë°©ì‹_ì„ ì •ì‚¬ìœ '] || '-'}</p>
                            </div>
                            <div>
                                <p class="text-gray-500">ì…ì°°ê³„íšì„œ ë¯¸ìŠ¹ì¸ (${pr['ë¯¸ìŠ¹ì¸ì‚¬ìœ ì½”ë“œ'] || '002_2'})</p>
                                <p class="text-xs bg-white p-2 rounded border">${pr['ë¯¸ìŠ¹ì¸ì‚¬ìœ '] || '-'}</p>
                            </div>
                        </div>
                    </div>

                    <!-- AI íŒë‹¨ -->
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                        <h4 class="font-medium text-purple-800 mb-3">ğŸ§  AI íŒë‹¨</h4>
                        <div class="space-y-2 text-sm">
                            <p><strong>ì˜ˆì •ê°€ ì‚°ì •:</strong> ${pr['ì˜ˆì •ê°€_ì‚°ì •ë°©ë²•'] || '-'}</p>
                            ${pr['ê³„ì•½ë°©ì‹'] === 'ìˆ˜ì˜ê³„ì•½' ? `
                                <p><strong>ìˆ˜ì˜ê³„ì•½ ì ì •ì„±:</strong> ${pr['ìˆ˜ì˜ê³„ì•½_ì ì •ì„±'] || '-'}</p>
                                <p><strong>ë‹¨ê°€ë³€ë™ë¥ :</strong> ${(pr['ë‹¨ê°€ë³€ë™ë¥ '] || 0).toFixed(1)}%</p>
                            ` : `
                                <p><strong>ìµœì €ê°€ ì ì •ì„±:</strong> ${pr['ìµœì €ê°€_ì ì •ì„±'] || '-'}</p>
                                <p><strong>ê²¬ì ê²½ìŸë ¥:</strong> ${pr['ê²¬ì ê²½ìŸë ¥_ì‹ í˜¸'] || ''} ${pr['ê²¬ì ê²½ìŸë ¥'] || '-'}</p>
                            `}
                            ${pr['HITLí•„ìš”'] ? '<p class="text-orange-600"><i class="fas fa-exclamation-triangle mr-1"></i>ë‹´ë‹¹ì ê²€í†  í•„ìš”</p>' : ''}
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex justify-end space-x-3 pt-4 border-t">
                        ${pr['HITLí•„ìš”'] ? `
                            <button onclick="openHitlModal('${pr['êµ¬ë§¤ìš”ì²­']}')" class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700">
                                âš ï¸ ê²€í† í•˜ê¸°
                            </button>
                        ` : ''}
                        <button onclick="approvePR('${pr['êµ¬ë§¤ìš”ì²­']}')" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                            âœ… ìŠ¹ì¸
                        </button>
                        <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            SRM ì „ì†¡
                        </button>
                    </div>
                </div>
            `;
        }
        
        // ì´ˆì²­í˜‘ë ¥íšŒì‚¬ 2~3ê°œ ëœë¤ ìƒì„±
        function generateRandomVendors(pr) {
            const sampleVendors = [
                '(ì£¼)ëŒ€í•œë°°ê´€', 'ì‚¼ì„±ì¤‘ê³µì—…', 'í˜„ëŒ€ìŠ¤í‹¸', 'í¬ìŠ¤ì½”ê±´ì„¤',
                'í•œí™”ì—ì–´ë¡œìŠ¤í˜ì´ìŠ¤', 'STXì¤‘ê³µì—…', 'ëŒ€ìš°ì¡°ì„ í•´ì–‘', 'SKì—ì½”í”ŒëœíŠ¸',
                'ë‘ì‚°ì¤‘ê³µì—…', 'GSê±´ì„¤', 'í•œì§„ì¤‘ê³µì—…', 'ì‚¼í˜¸ì¤‘ê³µì—…'
            ];
            
            const vendors = [];
            
            // ë§¤ì¹­ì—…ì²´ê°€ ìˆìœ¼ë©´ ë¨¼ì € ì¶”ê°€
            if (pr['ë§¤ì¹­ì—…ì²´ëª…']) {
                vendors.push({ name: pr['ë§¤ì¹­ì—…ì²´ëª…'], isMatched: true });
            }
            
            // ëœë¤ìœ¼ë¡œ 1~2ê°œ ì¶”ê°€ (ì´ 2~3ê°œê°€ ë˜ë„ë¡)
            const count = pr['ë§¤ì¹­ì—…ì²´ëª…'] ? Math.floor(Math.random() * 2) + 1 : Math.floor(Math.random() * 2) + 2;
            const shuffled = sampleVendors.filter(v => v !== pr['ë§¤ì¹­ì—…ì²´ëª…']).sort(() => 0.5 - Math.random());
            
            for (let i = 0; i < count && i < shuffled.length; i++) {
                vendors.push({ name: shuffled[i], isMatched: false });
            }
            
            return vendors;
        }

        // HITL Modal
        function openHitlModal(prId) {
            const pr = quotationData.find(p => p['êµ¬ë§¤ìš”ì²­'] === prId);
            if (!pr) return;

            document.getElementById('modalPrId').textContent = prId;
            
            const content = document.getElementById('modalContent');
            content.innerHTML = `
                <div class="space-y-4">
                    <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                        <h4 class="font-medium text-orange-800 mb-2">ğŸ“Œ ${pr['ê³„ì•½ë°©ì‹'] === 'ìˆ˜ì˜ê³„ì•½' ? 'ìˆ˜ì˜ê³„ì•½ ì ì •ì„±' : 'ìµœì €ê°€ ì ì •ì„±'} ê²€í†  ê²°ê³¼: âš ï¸ ${pr['ìˆ˜ì˜ê³„ì•½_ì ì •ì„±'] || pr['ìµœì €ê°€_ì ì •ì„±'] || 'ê²€í† í•„ìš”'}</h4>
                        
                        <div class="bg-white rounded p-3 space-y-2 text-sm">
                            <div class="flex justify-between"><span>ê²¬ì ë‹¨ê°€</span><span class="font-medium">â‚©${Math.round(pr['ê²¬ì ë‹¨ê°€'] || 0).toLocaleString()}</span></div>
                            <div class="flex justify-between"><span>ì…ì°°ì˜ˆì •ê°€</span><span class="font-medium">â‚©${(pr['ì…ì°°ì˜ˆì •ê°€'] || 0).toLocaleString()}</span></div>
                            <div class="flex justify-between"><span>ìµœê·¼ë°œì£¼ë‹¨ê°€</span><span class="font-medium">â‚©${Math.round(pr['ìµœê·¼ë°œì£¼ë‹¨ê°€'] || 0).toLocaleString()}</span></div>
                            <hr>
                            ${pr['ê³„ì•½ë°©ì‹'] === 'ìˆ˜ì˜ê³„ì•½' ? `
                                <div class="flex justify-between"><span>ë‹¨ê°€ë³€ë™ë¥ </span><span class="font-medium ${(pr['ë‹¨ê°€ë³€ë™ë¥ '] || 0) > 15 ? 'text-red-600' : ''}">${(pr['ë‹¨ê°€ë³€ë™ë¥ '] || 0).toFixed(1)}% ${(pr['ë‹¨ê°€ë³€ë™ë¥ '] || 0) > 15 ? 'âš ï¸' : ''}</span></div>
                            ` : `
                                <div class="flex justify-between"><span>ì˜ˆì •ê°€ ëŒ€ë¹„</span><span class="font-medium">${((pr['ê²¬ì ë‹¨ê°€'] / pr['ì˜ˆì •ë‹¨ê°€'] - 1) * 100).toFixed(1)}%</span></div>
                            `}
                        </div>
                        
                        <div class="mt-3 p-3 bg-purple-50 rounded text-sm">
                            <p class="font-medium text-purple-800">ğŸ§  AI ë¶„ì„:</p>
                            <p class="text-gray-700 mt-1">${pr['ê³„ì•½ë°©ì‹'] === 'ìˆ˜ì˜ê³„ì•½' 
                                ? 'ë‹¨ê°€ë³€ë™ë¥ ì´ í—ˆìš©ë²”ìœ„(15%)ë¥¼ ì´ˆê³¼í•˜ì—¬ í˜‘ìƒì´ í•„ìš”í•©ë‹ˆë‹¤. ìµœê·¼ ì›ìì¬ ê°€ê²© ë³€ë™ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì‹œê³ , ì—…ì²´ì™€ ë‹¨ê°€ í˜‘ìƒì„ ì§„í–‰í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.'
                                : 'ê²¬ì ë‹¨ê°€ê°€ ì˜ˆì •ê°€ ëŒ€ë¹„ ë‚®ì•„ ë¤í•‘ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì—…ì²´ì˜ ê³¼ê±° ë‚©í’ˆ í’ˆì§ˆ ì´ë ¥ì„ í™•ì¸í•˜ì‹œê³ , í•„ìš”ì‹œ í’ˆì§ˆë³´ì¦ ì¡°ê±´ ì¶”ê°€ë¥¼ ê¶Œê³ í•©ë‹ˆë‹¤.'
                            }</p>
                        </div>
                    </div>

                    <div class="border rounded-lg p-4">
                        <h4 class="font-medium mb-3">ë‹´ë‹¹ì ê²°ì •</h4>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="radio" name="decision" value="approve" class="mr-2">
                                <span>ì ì • (ì§„í–‰)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="decision" value="renegotiate" class="mr-2">
                                <span>ì¬ê²¬ì  ìš”ì²­</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="decision" value="conditional" class="mr-2" checked>
                                <span>ì¡°ê±´ë¶€ ìŠ¹ì¸</span>
                            </label>
                        </div>
                        
                        <div class="mt-4">
                            <label class="text-sm text-gray-600">ì¡°ê±´/ì‚¬ìœ :</label>
                            <textarea id="decisionReason" class="w-full border rounded p-2 mt-1 text-sm" rows="3" placeholder="ê²°ì • ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">í’ˆì§ˆë³´ì¦ê¸°ê°„ 2ë…„ ì¡°ê±´ ì¶”ê°€ í›„ ì§„í–‰</textarea>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('hitlModal').classList.remove('hidden');
            document.getElementById('hitlModal').dataset.prId = prId;
        }

        function closeHitlModal() {
            document.getElementById('hitlModal').classList.add('hidden');
        }

        function submitHitlDecision() {
            const prId = document.getElementById('hitlModal').dataset.prId;
            const decision = document.querySelector('input[name="decision"]:checked')?.value;
            const reason = document.getElementById('decisionReason').value;
            
            // Update PR status
            const pr = quotationData.find(p => p['êµ¬ë§¤ìš”ì²­'] === prId);
            if (pr) {
                pr['ì²˜ë¦¬ìƒíƒœ'] = 'ìë™ì™„ë£Œ';
                pr['HITLí•„ìš”'] = false;
                pr['ë‹´ë‹¹ìê²°ì •'] = decision;
                pr['ê²°ì •ì‚¬ìœ '] = reason;
            }
            
            closeHitlModal();
            renderPRList();
            renderDetailView(prId);
            alert('ê²°ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        async function approvePR(prId) {
            try {
                await axios.post(`/api/quotations/${prId}/approve`);
                const pr = quotationData.find(p => p['êµ¬ë§¤ìš”ì²­'] === prId);
                if (pr) {
                    pr['ìŠ¹ì¸ìƒíƒœ'] = 'ìŠ¹ì¸ì™„ë£Œ';
                }
                alert('ìŠ¹ì¸ ì™„ë£Œ');
                renderPRList();
                renderDetailView(prId);
            } catch (e) {
                alert('ìŠ¹ì¸ ì‹¤íŒ¨: ' + (e.response?.data?.error || e.message));
            }
        }

        // Final Report (Step 4)
        function updateFinalReport() {
            if (!processingResults || !processingResults.summary) return;

            const summary = processingResults.summary;
            
            document.getElementById('totalProcessed').textContent = `${summary.total}ê±´ ì²˜ë¦¬ ì™„ë£Œ`;
            document.getElementById('finalAutoCount').textContent = `${summary.autoComplete}ê±´`;
            document.getElementById('finalHitlCount').textContent = `${summary.needReview}ê±´`;
            document.getElementById('finalUrgent').textContent = summary.urgent;
            document.getElementById('finalNormal').textContent = summary.normal;
            document.getElementById('finalFlexible').textContent = summary.flexible;
            document.getElementById('finalLlmCalls').textContent = summary.llmCalls;
            document.getElementById('finalTime').textContent = summary.processingTime;

            const autoPercent = summary.total > 0 ? (summary.autoComplete / summary.total) * 100 : 0;
            const hitlPercent = summary.total > 0 ? (summary.needReview / summary.total) * 100 : 0;
            
            document.getElementById('autoBar').style.width = `${autoPercent}%`;
            document.getElementById('hitlBar').style.width = `${hitlPercent}%`;
        }

        async function downloadExcel() {
            try {
                const response = await axios.get('/api/export', { responseType: 'blob' });
                const url = window.URL.createObjectURL(new Blob([response.data]));
                const link = document.createElement('a');
                link.href = url;
                link.setAttribute('download', 'PR_PO_Agent_Result.xlsx');
                document.body.appendChild(link);
                link.click();
                link.remove();
            } catch (e) {
                alert('ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨: ' + e.message);
            }
        }

        async function batchApprove() {
            const autoCompletePRs = quotationData
                .filter(p => p['ì²˜ë¦¬ìƒíƒœ'] === 'ìë™ì™„ë£Œ')
                .map(p => p['êµ¬ë§¤ìš”ì²­']);

            if (autoCompletePRs.length === 0) {
                alert('ìŠ¹ì¸í•  PRì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            if (!confirm(`${autoCompletePRs.length}ê±´ì„ ì¼ê´„ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }

            try {
                await axios.post('/api/quotations/batch-approve', { ids: autoCompletePRs });
                alert(`${autoCompletePRs.length}ê±´ ì¼ê´„ ìŠ¹ì¸ ì™„ë£Œ (SRM ì „ì†¡ ì‹œë®¬ë ˆì´ì…˜)`);
            } catch (e) {
                alert('ì¼ê´„ ìŠ¹ì¸ ì‹¤íŒ¨: ' + e.message);
            }
        }

        // ============================================
        // Email Functions
        // ============================================
        
        // State for tracking sent emails
        let sentEmails = {};

        // Open batch email confirmation modal
        function openBatchEmailModal() {
            const invalidPR = processingResults?.invalidPR || [];
            if (invalidPR.length === 0) {
                alert('ë°œì†¡í•  ëˆ„ë½ PRì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // Group by ë‹´ë‹¹ì
            const grouped = {};
            invalidPR.forEach(pr => {
                const manager = pr['ë‹´ë‹¹ì'] || pr['êµ¬ë§¤ìš”ì²­ì'] || 'ë‹´ë‹¹ìë¯¸ì§€ì •';
                if (!grouped[manager]) grouped[manager] = [];
                grouped[manager].push(pr);
            });

            const managerCount = Object.keys(grouped).length;
            const prCount = invalidPR.length;

            let managerList = '';
            Object.entries(grouped).forEach(([manager, prs]) => {
                managerList += `<p class="text-sm">â€¢ ${manager}: ${prs.length}ê±´</p>`;
            });

            document.getElementById('batchEmailContent').innerHTML = `
                <div class="space-y-4">
                    <div class="bg-blue-50 rounded-lg p-4">
                        <p class="font-medium mb-2">ë°œì†¡ ëŒ€ìƒ: ${managerCount}ëª…</p>
                        ${managerList}
                    </div>
                    <p class="text-gray-600">ì´ <strong>${prCount}ê±´</strong>ì˜ ëˆ„ë½ PR ì•ˆë‚´ ë©”ì¼ì„ ë°œì†¡í•©ë‹ˆë‹¤.</p>
                </div>
            `;

            document.getElementById('batchEmailModal').classList.remove('hidden');
        }

        function closeBatchEmailModal() {
            document.getElementById('batchEmailModal').classList.add('hidden');
        }

        // Send batch emails
        function sendBatchEmails() {
            const invalidPR = processingResults?.invalidPR || [];
            
            // Group by ë‹´ë‹¹ì
            const grouped = {};
            invalidPR.forEach(pr => {
                const manager = pr['ë‹´ë‹¹ì'] || pr['êµ¬ë§¤ìš”ì²­ì'] || 'ë‹´ë‹¹ìë¯¸ì§€ì •';
                if (!grouped[manager]) grouped[manager] = [];
                grouped[manager].push(pr);
            });

            // Mark all as sent
            invalidPR.forEach((pr, idx) => {
                sentEmails[idx] = {
                    sentAt: new Date().toISOString(),
                    recipient: pr['ë‹´ë‹¹ì'] || pr['êµ¬ë§¤ìš”ì²­ì'] || 'ë‹´ë‹¹ìë¯¸ì§€ì •'
                };
            });

            const managerCount = Object.keys(grouped).length;
            const prCount = invalidPR.length;

            closeBatchEmailModal();

            // Update the table to show "ë°œì†¡ì™„ë£Œ" status
            updateInvalidPRListWithStatus();

            // Show success modal
            document.getElementById('emailSentMessage').textContent = 
                `${managerCount}ëª…ì—ê²Œ ${prCount}ê±´ì˜ ë©”ì¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.`;
            document.getElementById('emailSentModal').classList.remove('hidden');
        }

        function closeEmailSentModal() {
            document.getElementById('emailSentModal').classList.add('hidden');
        }

        // Update invalid PR list to show sent status
        function updateInvalidPRListWithStatus() {
            const invalidPR = processingResults?.invalidPR || [];
            
            document.getElementById('invalidPRList').innerHTML = invalidPR.slice(0, 50).map((pr, idx) => {
                const isSent = sentEmails[idx];
                return `
                    <tr class="border-b hover:bg-gray-50 ${isSent ? 'bg-green-50' : ''}">
                        <td class="px-4 py-3">${isSent ? 'âœ…' : 'âš ï¸'} ${pr['êµ¬ë§¤ìš”ì²­'] || '-'}</td>
                        <td class="px-4 py-3">${pr['ìì¬ë²ˆí˜¸'] || '-'}</td>
                        <td class="px-4 py-3 text-red-600">${pr['ëˆ„ë½í•­ëª©'] || '-'}</td>
                        <td class="px-4 py-3">${pr['ë‹´ë‹¹ì'] || pr['êµ¬ë§¤ìš”ì²­ì'] || '-'}</td>
                        <td class="px-4 py-3">
                            ${isSent ? `
                                <button onclick="openEmailPreview(${idx})" class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs hover:bg-green-200">
                                    âœ‰ï¸ ë°œì†¡ì™„ë£Œ
                                </button>
                            ` : `
                                <button onclick="openEmailPreview(${idx})" class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200">
                                    ğŸ“§ ë¯¸ë¦¬ë³´ê¸°
                                </button>
                            `}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Open email preview modal for a specific PR
        function openEmailPreview(prIndex) {
            const invalidPR = processingResults?.invalidPR || [];
            const pr = invalidPR[prIndex];
            if (!pr) return;

            const manager = pr['ë‹´ë‹¹ì'] || pr['êµ¬ë§¤ìš”ì²­ì'] || 'ë‹´ë‹¹ìë¯¸ì§€ì •';
            const email = `${manager.replace(/\s/g, '').toLowerCase()}@company.com`;
            const isSent = sentEmails[prIndex];

            document.getElementById('emailPreviewContent').innerHTML = `
                <div class="space-y-4">
                    ${isSent ? `
                        <div class="bg-green-50 border border-green-200 rounded-lg p-3 text-green-700 text-sm">
                            âœ… ë°œì†¡ì™„ë£Œ: ${new Date(isSent.sentAt).toLocaleString()}
                        </div>
                    ` : ''}
                    
                    <div class="border rounded-lg overflow-hidden">
                        <div class="bg-gray-50 px-4 py-3 border-b">
                            <p class="text-sm"><strong>To:</strong> ${manager} &lt;${email}&gt;</p>
                            <p class="text-sm"><strong>Subject:</strong> [PR í•„ìˆ˜í•­ëª© ëˆ„ë½] 1ê±´ ì •ë³´ ì—…ë°ì´íŠ¸ ìš”ì²­</p>
                        </div>
                        
                        <div class="p-4 space-y-4 text-sm">
                            <p>ì•ˆë…•í•˜ì„¸ìš”, <strong>${manager}</strong>ë‹˜</p>
                            
                            <p>ì•„ë˜ êµ¬ë§¤ìš”ì²­ ê±´ì— í•„ìˆ˜í•­ëª©ì´ ëˆ„ë½ë˜ì–´ ì²˜ë¦¬ê°€ ë¶ˆê°€í•©ë‹ˆë‹¤.<br>
                            í™•ì¸ í›„ ì—…ë°ì´íŠ¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤.</p>
                            
                            <div class="bg-gray-50 border rounded-lg p-4 space-y-2">
                                <p class="font-bold">â–  ëˆ„ë½ PR ë‚´ì—­</p>
                                <table class="w-full text-sm">
                                    <tr><td class="py-1 text-gray-600 w-24">PRë²ˆí˜¸:</td><td class="font-medium">${pr['êµ¬ë§¤ìš”ì²­'] || '-'}</td></tr>
                                    <tr><td class="py-1 text-gray-600">ìì¬ë²ˆí˜¸:</td><td class="font-medium">${pr['ìì¬ë²ˆí˜¸'] || '-'}</td></tr>
                                    <tr><td class="py-1 text-gray-600">ìì¬ë‚´ì—­:</td><td class="font-medium">${pr['ë‚´ì—­'] || '-'}</td></tr>
                                    <tr><td class="py-1 text-gray-600">ëˆ„ë½í•­ëª©:</td><td class="font-medium text-red-600">${pr['ëˆ„ë½í•­ëª©'] || '-'}</td></tr>
                                </table>
                            </div>
                            
                            <p>ê°ì‚¬í•©ë‹ˆë‹¤.</p>
                            <p class="text-gray-600">êµ¬ë§¤íŒ€ AI Agent</p>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('emailPreviewModal').classList.remove('hidden');
        }

        function closeEmailPreviewModal() {
            document.getElementById('emailPreviewModal').classList.add('hidden');
        }
    </script>
</body>
</html>
